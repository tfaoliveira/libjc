#!/bin/bash

# TODO: implement: ./build all && ./build libsodium && etc

### some common folder names 
root="`pwd`"
src_libs_dir="$root/third_party"
static_libs_dir="$root/third_party_static_libs"
shared_libs_dir="$root/third_party_shared_libs"

mkdir -p $static_libs_dir
mkdir -p $shared_libs_dir

### openssl
openssl_dir="$src_libs_dir/openssl"
openssl_build_info="$root/patch/openssl/crypto/sha/build-keccak-avx2.info"

### openssl static
./scripts/openssl_static $openssl_dir $static_libs_dir
./scripts/openssl_static_no_asm $openssl_dir $static_libs_dir

### openssl shared (necessary to benchmark keccak; but can also be used for any other primitive):
###  - openssl_shared: keccak asm implementation
###  - openssl_shared_no_asm : keccak c implementation
###  - openssl_shared_keccak_avx2 : keccak asm avx2 implementation
./scripts/openssl_shared $openssl_dir $shared_libs_dir
./scripts/openssl_shared_no_asm $openssl_dir $shared_libs_dir
./scripts/openssl_shared_keccak_avx2 $openssl_dir $shared_libs_dir $openssl_build_info

### libsodium
libsodium_dir="$src_libs_dir/libsodium"
./scripts/libsodium_static $libsodium_dir $static_libs_dir
./scripts/libsodium_static_disable_asm $libsodium_dir $static_libs_dir
./scripts/libsodium_static_disable_asm_ccomp $libsodium_dir $static_libs_dir


### boringssl
boringssl_dir="$src_libs_dir/boringssl"
./scripts/boringssl_static $boringssl_dir $static_libs_dir

### hacl-star
hacl_star_dir="$src_libs_dir/hacl-star/dist/gcc64-only"
./scripts/hacl_star_gcc $hacl_star_dir $static_libs_dir

####### old stuff
###hacl_star_ccomp_dir="$src_libs_dir/hacl-star/snapshots/hacl-c-compcert"
###hacl_star_ccomp_makefile="$root/patch/hacl-star/Makefile"
###./scripts/hacl_star_ccomp $hacl_star_ccomp_dir $static_libs_dir $hacl_star_ccomp_makefile
#######

### usuba
usuba_dir="$src_libs_dir/usuba/supercop/crypto_stream/chacha20"
./scripts/usuba_copy $usuba_dir $root

###fld-ecc-vec
fld_ecc_vec_dir="$src_libs_dir/fld-ecc-vec/"
./scripts/fld-ecc-vec_static $fld_ecc_vec_dir $static_libs_dir


